{
  "hash": "6a513a350f4ceed553573e784854a2ce",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\n---\n\n\n> ### **`Assignment 12:`**\n\nUsing the example of the coupons provided in the course content. Check how sensitive the result is to changing the bandwidth by running the analysis:  \n  1. with half the bandwidth  \n  2. with double the bandwidth  \n\n  \n3. New Example: For a limited amount of time, for purchases with a total amount of more than 30€ you offered free shipping. The data can be seen in shipping.rds. Have a look at the variable purchase_amount and argue whether it could generally be used as a running variable with a cut-off at 30€.Use a plot to confirm your argument.\n\n### **Solution:**  \n\n1,2. Coupons Example:\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_f9a0e45458e4db03d52d5e8cb3d80b7d'}\n\n```{.r .cell-code}\n#Load Libraries & Data\n\nlibrary(dplyr)    \n\n\ndf <- readRDS(\"D:/OneDrive/Samantha/TUHH/1stsemester/Causal Data Science for Business Analytics (SE)/Causal_Data_Science_Data/coupon.rds\")\nc0 <- 60\n\nhead(df)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"days_since_last\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"days_since_last_centered\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"coupon\"],\"name\":[3],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"purchase_after\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"82.0\",\"2\":\"22.0\",\"3\":\"TRUE\",\"4\":\"22.821321\"},{\"1\":\"39.0\",\"2\":\"-21.0\",\"3\":\"FALSE\",\"4\":\"11.583787\"},{\"1\":\"7.2\",\"2\":\"-52.8\",\"3\":\"FALSE\",\"4\":\"15.982824\"},{\"1\":\"115.6\",\"2\":\"55.6\",\"3\":\"TRUE\",\"4\":\"20.458175\"},{\"1\":\"17.0\",\"2\":\"-43.0\",\"3\":\"FALSE\",\"4\":\"8.904734\"},{\"1\":\"42.8\",\"2\":\"-17.2\",\"3\":\"FALSE\",\"4\":\"6.723591\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n#Analysis with half the tested band width \nbw_half <- c0 + c(-2.5, 2.5)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_half_below <- df %>% filter(days_since_last >= bw_half[1] & days_since_last < c0)\ndf_bw_half_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw_half[2])\n\ndf_bw_half <- bind_rows(df_bw_half_above, df_bw_half_below)\ndim(df_bw_half)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 181   4\n```\n:::\n\n```{.r .cell-code}\n# Extract values for vertical lines to visualize local average treatment effect\nmodel_bw_half_below <- lm(purchase_after ~ days_since_last, df_bw_half_below)\nmodel_bw_half_above <- lm(purchase_after ~ days_since_last, df_bw_half_above)\n\ny0_half <- predict(model_bw_half_below, tibble(days_since_last = c0))\ny1_half <- predict(model_bw_half_above, tibble(days_since_last = c0))\n\nlate_half <- y1_half - y0_half\nsprintf(\"LATE of 0.5 bw: %.2f\", late_half)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE of 0.5 bw: 7.36\"\n```\n:::\n\n```{.r .cell-code}\nlm_bw_half <- lm(purchase_after ~ days_since_last_centered + coupon, df_bw_half)\nsummary(lm_bw_half)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_bw_half)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -10.9680  -2.2013   0.1676   2.1516   8.2567 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               11.6612     0.5747  20.292  < 2e-16 ***\n#> days_since_last_centered   0.6883     0.3219   2.138   0.0339 *  \n#> couponTRUE                 7.1679     1.0172   7.047 3.87e-11 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.289 on 178 degrees of freedom\n#> Multiple R-squared:  0.6622,\tAdjusted R-squared:  0.6584 \n#> F-statistic: 174.5 on 2 and 178 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n#Analysis with double the tested band width \nbw_double <- c0 + c(-10, 10)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_double_below <- df %>% filter(days_since_last >= bw_double[1] & days_since_last < c0)\ndf_bw_double_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw_double[2])\n\ndf_bw_double <- bind_rows(df_bw_double_above, df_bw_double_below)\ndim(df_bw_double)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 629   4\n```\n:::\n\n```{.r .cell-code}\n# Extract values for vertical lines to visualize local average treatment effect\nmodel_bw_double_below <- lm(purchase_after ~ days_since_last, df_bw_double_below)\nmodel_bw_double_above <- lm(purchase_after ~ days_since_last, df_bw_double_above)\n\ny0_double <- predict(model_bw_double_below, tibble(days_since_last = c0))\ny1_double <- predict(model_bw_double_above, tibble(days_since_last = c0))\n\nlate_double <- y1_double - y0_double\nsprintf(\"LATE of 2 bw: %.2f\", late_double)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE of 2 bw: 9.51\"\n```\n:::\n\n```{.r .cell-code}\nlm_bw_double <- lm(purchase_after ~ days_since_last_centered + coupon, df_bw_double)\nsummary(lm_bw_double)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_bw_double)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -12.2718  -2.0858  -0.0003   2.0275  10.6749 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)              10.61700    0.27386  38.767   <2e-16 ***\n#> days_since_last_centered  0.01413    0.04255   0.332     0.74    \n#> couponTRUE                9.51584    0.48628  19.569   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.115 on 626 degrees of freedom\n#> Multiple R-squared:  0.7052,\tAdjusted R-squared:  0.7042 \n#> F-statistic: 748.6 on 2 and 626 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nDecreasing the bandwidth didn't have significant change, however, increasing the bandwidth made the estimate value higher. Therefore we have to include the theoretical background in our Analysis.\n\n3. Running Variable Check:\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_72429d9cfdab2450ea225d81f1bf7043'}\n\n```{.r .cell-code}\n#Load Libraries & Data:\n\nlibrary(rddensity)  \n\n\nshipping <- readRDS(\"D:/OneDrive/Samantha/TUHH/1stsemester/Causal Data Science for Business Analytics (SE)/Causal_Data_Science_Data/shipping.rds\")\nhead(shipping)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"purchase_amount\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"13.105677\"},{\"1\":\"37.120848\"},{\"1\":\"11.258422\"},{\"1\":\"9.453785\"},{\"1\":\"53.237258\"},{\"1\":\"20.541164\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Visually check continuity at running variable\nrddd <- rddensity(shipping$purchase_amount, c = 30)\nsummary(rddd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       6666\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         3088                3578                \n#> Eff. Number of obs    2221                1955                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           22.909              20.394              \n#> \n#> Method                T                   P > |T|             \n#> Robust                5.9855              0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rddd): There are repeated observations. Point\n#> estimates and standard errors have been adjusted. Use option massPoints=FALSE\n#> to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.261                      20      26    0.4614\n#> 0.522                      41      65    0.0250\n#> 0.783                      62     107    0.0007\n#> 1.043                      81     136    0.0002\n#> 1.304                     100     169    0.0000\n#> 1.565                     114     196    0.0000\n#> 1.826                     132     227    0.0000\n#> 2.087                     156     263    0.0000\n#> 2.348                     173     298    0.0000\n#> 2.609                     191     331    0.0000\n```\n:::\n\n```{.r .cell-code}\nrdd_plot <- rdplotdensity(rddd, shipping$purchase_amount, plotN = 100)\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nBased on the plot, the purchase_amount can't be used as a running variable as it is not continuous around the cutoff value. And there is no overlapping between the confedance intervals.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}