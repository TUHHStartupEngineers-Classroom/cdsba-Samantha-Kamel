{
  "hash": "ba7e70a0baf9c2931808b1925f439676",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\n---\n\n\n> ### **`Assignment 11:`**  \nyou have developed an app and you are already having an active user base. Of course, some users are more active than other users. Also, users might use the app for different purposes. In general, user behavior likely depends on a lot of unobserved characteristics.\nObviously, your goal is to keep users as long as possible on the app to maximize your ad revenues. To do that, you want to introduce a new feature and see how it affects time spent on the app. Simply comparing users who use the newly introduced feature to users who don’t would result in a biased estimate due to the unobserved confounders regarding their activity and willingness to use a new feature.\nTherefore, you perform a so called randomized encouragement trial, where for a random selection of users, a popup appears when opening the app and encourages these users to test new feature. The users who are not randomly selected don’t get a popup message but could also use the new feature.  \n\n1. Draw a DAG of how you understand the relationships.  \n2. Compute the naive, biased estimate.  \n3. For the assumptions that can be (partly) tested, check whether they are satisfied by either computing correlations or drawing plots. Argue whether instrumental variable estimation is an adequate procedure.  \n4. Compute the IV estimate using 2SLS and compare it to the naive estimate. Would you consider the naive estimate biased, and if yes, does it have an upward or downward bias?  \n\n### **Solution:**  \n\n1. DAG:\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_dad4f6651978c69af769c9161dc05244'}\n\n```{.r .cell-code}\n#Loading Libraries & Data\n\nlibrary(tidyverse)  \n\n\nlibrary(dagitty)  \n\n\nlibrary(ggdag)\n\n\nlibrary(estimatr)  \n\n\nrand_enc <- readRDS(\"D:/OneDrive/Samantha/TUHH/1stsemester/Causal Data Science for Business Analytics (SE)/Causal_Data_Science_Data/rand_enc.rds\")\n\nhead(rand_enc)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"rand_enc\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"used_ftr\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"time_spent\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"1\",\"3\":\"30.51346\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"19.78372\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"28.59107\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"18.63635\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"14.55074\"},{\"1\":\"1\",\"2\":\"0\",\"3\":\"12.41954\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n#Define DAG\niv_expl <- dagify(\n  Y ~ D,\n  Y ~ U,\n  D ~ U,\n  D ~ Z,\n  exposure = \"D\",\n  latent = \"U\",\n  outcome = \"Y\",\n  coords = list(x = c(U = 1, D = 0, Y = 2, Z = -1),\n                y = c(U = 1, D = 0, Y = 0, Z = 0)),\n  labels = c(\"D\" = \"Using New Feature\", \n             \"Y\" = \"Time Spent\", \n             \"U\" = \"Activity\",\n             \"Z\" = \"Randomized Encouragement Trial\")\n)\n\n#DAG\nggdag(iv_expl, text = T) +\n      geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n2. Naive, Biased Estimate:  \n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_8487d372416f0677c225012fd2eca86a'}\n\n```{.r .cell-code}\n#Direct regression\nnaive_est <- lm(time_spent ~ used_ftr, data=rand_enc)\nsummary(naive_est)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = rand_enc)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n3. Assumptions Check: \n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_ed170859aaea5ec65e71de8afba0466c'}\n\n```{.r .cell-code}\n#Correlation:\napp_assume <- rand_enc %>%\n  filter(used_ftr == 1)\n\ncor(app_assume$rand_enc,app_assume$time_spent)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] -0.02744462\n```\n:::\n:::\n\n\nSince the correlation value is a very small negative value, the rand_enc and the outcome are not correlated and hence it could be used as an instrumental variable.\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_ca7491d5bbe689c1d430ea658796b64d'}\n\n```{.r .cell-code}\n#Correlation Matrix\ncor(rand_enc) %>% round(2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>            rand_enc used_ftr time_spent\n#> rand_enc       1.00     0.20       0.13\n#> used_ftr       0.20     1.00       0.71\n#> time_spent     0.13     0.71       1.00\n```\n:::\n\n```{.r .cell-code}\n#Plotting\nggplot(rand_enc, aes(x = time_spent, y = used_ftr, color = as.factor(used_ftr))) +\n  geom_jitter(alpha = .5) +\n  scale_color_discrete(labels = c(\"Control Group\", \"Treatment Group\")) +\n  theme(legend.title = element_blank()) + ggtitle(\"Time Spent vs Used Feature\")\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(rand_enc, aes(x = time_spent, y = rand_enc, color = as.factor(rand_enc))) +\n  geom_jitter(alpha = .5) +\n  scale_color_discrete(labels = c(\"Without Trial\", \"With Trial\")) +\n  theme(legend.title = element_blank()) + ggtitle(\"Time Spent vs Trail Application\")\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(rand_enc, aes(x = used_ftr, y = rand_enc, color = as.factor(rand_enc))) +\n  geom_jitter(alpha = .5) +\n  scale_color_discrete(labels = c(\"Without Trial\", \"With Trial\")) +\n  theme(legend.title = element_blank()) + ggtitle(\"Used Feature vs Trail Application\")\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\n4. 2SLS:  \n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_c24f7bfc7eee8b566726b27c628111a5'}\n\n```{.r .cell-code}\n#IV\nmodel_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = rand_enc)\nsummary(model_iv) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = rand_enc)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nThe naive estimate is considered biased as the estimate value is higher and the bias is upward.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}