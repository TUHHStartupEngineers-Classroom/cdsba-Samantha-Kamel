{
  "hash": "833f894ab6e98ab360ea1c72f1c20d0a",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-Differences\"\n---\n\n\n> ### **`Assignment 10:`**\nImagine, you are manager of a large health provider that manages many hospitals and you want to test how a new admission procedure affects patient satisfaction. You randomly selected 18 hospitals that introduced the new admission procedure and compare them to 28 other hospitals that did not introduce the method. For both groups of hospitals you collected data from before and after the introduction. The data you have collected is from patient surveys where they were asked how satisfied they are. Perform a difference-in-differences analysis by:  \n\n1. Manually computing the mean satisfaction for treated and control hospitals before and after the treatment. Helpful functions could be filter(), pull() and basic arithmetic operations.  \n\n2. Using a linear regression to compute the estimate. Also, include group and time fixed effects in the regression, i.e. one regressor for each month and one regressor for each hospital: Consider, whether you want to include them as:  \n\na. month + hospital or as  \nb. as.factor(month) + as.factor(hospital)  \n\nand explain what the difference is.  \n\n### **Solution:**    \n\n1. Difference-in-Differences:  \n\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-1_c4c3ba21d2f5933e9fbf5ee91162c893'}\n\n```{.r .cell-code}\n#Load Libraries & Data\n\nlibrary(tidyverse)  \n\n\nhospdd <- readRDS(\"D:/OneDrive/Samantha/TUHH/1stsemester/Causal Data Science for Business Analytics (SE)/Causal_Data_Science_Data/hospdd.rds\")\n\nglimpse(hospdd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Rows: 7,368\n#> Columns: 5\n#> $ hospital  <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n#> $ frequency <int> 3, 2, 4, 2, 1, 1, 2, 4, 2, 2, 4, 1, 2, 3, 4, 2, 1, 2, 4, 2, …\n#> $ month     <int> 7, 3, 2, 4, 3, 7, 4, 1, 3, 1, 1, 4, 6, 1, 1, 4, 1, 2, 4, 6, …\n#> $ procedure <dbl> 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, …\n#> $ satis     <dbl> 4.106527, 3.319475, 3.411720, 3.004025, 3.110720, 2.882164, …\n```\n:::\n\n```{.r .cell-code}\n#DID\nbefore_control <- mean(hospdd %>%\n  filter(procedure == 0, hospital>18 & hospital<= 46) %>% \n  pull(satis))\n\n\nbefore_treatment <- mean(hospdd %>%\n  filter(procedure == 0, hospital>= 1 & hospital<=18) %>% \n  pull(satis))\n\n\ndiff_before <- before_treatment - before_control\n\nafter_control <- mean(hospdd %>%\n  filter(procedure == 1, hospital>18 & hospital<= 46) %>% \n  pull(satis))\n\nafter_control<- mean(rep(0,dim(hospdd)[1]))\n\nafter_treatment <- mean(hospdd %>%\n  filter(procedure == 1, hospital>= 1 & hospital<=18) %>% \n  pull(satis))\n\ndiff_after <- after_treatment - after_control\n\ndiff <- diff_after - diff_before\n\ndiff\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 4.225468\n```\n:::\n:::\n\n\n2. Regression:  \n\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-2_16ae07f1307bb0026c7fdb92f35e05d6'}\n\n```{.r .cell-code}\nlm_dat <- lm(satis ~ month + hospital, data=hospdd)\nsummary(lm_dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ month + hospital, data = hospdd)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.3831 -0.6724 -0.0838  0.5778  5.7881 \n#> \n#> Coefficients:\n#>               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  3.7597212  0.0308145  122.01   <2e-16 ***\n#> month        0.0720728  0.0055957   12.88   <2e-16 ***\n#> hospital    -0.0175982  0.0008732  -20.16   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 1.017 on 7365 degrees of freedom\n#> Multiple R-squared:  0.07208,\tAdjusted R-squared:  0.07183 \n#> F-statistic: 286.1 on 2 and 7365 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nlm_dat_as_factor <- lm(satis ~ as.factor(month) + as.factor(hospital), data=hospdd)\nsummary(lm_dat_as_factor)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ as.factor(month) + as.factor(hospital), \n#>     data = hospdd)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.4357 -0.4930 -0.0120  0.4755  4.5398 \n#> \n#> Coefficients:\n#>                        Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)            3.419332   0.057597  59.367  < 2e-16 ***\n#> as.factor(month)2     -0.009608   0.030411  -0.316 0.752069    \n#> as.factor(month)3      0.021969   0.030411   0.722 0.470083    \n#> as.factor(month)4      0.349354   0.030411  11.488  < 2e-16 ***\n#> as.factor(month)5      0.343235   0.030411  11.286  < 2e-16 ***\n#> as.factor(month)6      0.348800   0.030411  11.469  < 2e-16 ***\n#> as.factor(month)7      0.341444   0.030411  11.228  < 2e-16 ***\n#> as.factor(hospital)2   0.408566   0.080413   5.081 3.85e-07 ***\n#> as.factor(hospital)3   0.533625   0.082596   6.461 1.11e-10 ***\n#> as.factor(hospital)4   0.227510   0.076977   2.956 0.003131 ** \n#> as.factor(hospital)5  -0.145353   0.076977  -1.888 0.059030 .  \n#> as.factor(hospital)6   0.447863   0.076977   5.818 6.20e-09 ***\n#> as.factor(hospital)7   1.404416   0.074390  18.879  < 2e-16 ***\n#> as.factor(hospital)8   0.071876   0.079452   0.905 0.365685    \n#> as.factor(hospital)9  -1.518515   0.081457 -18.642  < 2e-16 ***\n#> as.factor(hospital)10  1.682845   0.080413  20.927  < 2e-16 ***\n#> as.factor(hospital)11  0.220965   0.079452   2.781 0.005431 ** \n#> as.factor(hospital)12 -0.095303   0.081457  -1.170 0.242047    \n#> as.factor(hospital)13  0.495593   0.078564   6.308 2.99e-10 ***\n#> as.factor(hospital)14  0.233043   0.082596   2.821 0.004793 ** \n#> as.factor(hospital)15 -0.144494   0.082596  -1.749 0.080263 .  \n#> as.factor(hospital)16  1.414268   0.080413  17.588  < 2e-16 ***\n#> as.factor(hospital)17  0.423543   0.083843   5.052 4.49e-07 ***\n#> as.factor(hospital)18  0.153276   0.097668   1.569 0.116609    \n#> as.factor(hospital)19 -1.169296   0.082596 -14.157  < 2e-16 ***\n#> as.factor(hospital)20 -0.376607   0.080413  -4.683 2.87e-06 ***\n#> as.factor(hospital)21  0.770343   0.085215   9.040  < 2e-16 ***\n#> as.factor(hospital)22  0.375321   0.083843   4.476 7.70e-06 ***\n#> as.factor(hospital)23  0.277726   0.082596   3.362 0.000776 ***\n#> as.factor(hospital)24 -0.732120   0.088421  -8.280  < 2e-16 ***\n#> as.factor(hospital)25  0.222480   0.094875   2.345 0.019055 *  \n#> as.factor(hospital)26 -0.209747   0.080413  -2.608 0.009116 ** \n#> as.factor(hospital)27 -0.822648   0.077742 -10.582  < 2e-16 ***\n#> as.factor(hospital)28  0.288001   0.085215   3.380 0.000729 ***\n#> as.factor(hospital)29 -0.175443   0.081457  -2.154 0.031288 *  \n#> as.factor(hospital)30 -0.591916   0.097668  -6.060 1.42e-09 ***\n#> as.factor(hospital)31  0.088091   0.080413   1.095 0.273344    \n#> as.factor(hospital)32 -0.747340   0.081457  -9.175  < 2e-16 ***\n#> as.factor(hospital)33 -0.877969   0.080413 -10.918  < 2e-16 ***\n#> as.factor(hospital)34 -0.424406   0.075599  -5.614 2.05e-08 ***\n#> as.factor(hospital)35 -0.069883   0.077742  -0.899 0.368729    \n#> as.factor(hospital)36  1.714149   0.078564  21.818  < 2e-16 ***\n#> as.factor(hospital)37 -0.283590   0.094875  -2.989 0.002807 ** \n#> as.factor(hospital)38 -0.510800   0.079452  -6.429 1.36e-10 ***\n#> as.factor(hospital)39 -0.447491   0.083843  -5.337 9.72e-08 ***\n#> as.factor(hospital)40  0.697539   0.079452   8.779  < 2e-16 ***\n#> as.factor(hospital)41 -0.573729   0.077742  -7.380 1.76e-13 ***\n#> as.factor(hospital)42  0.457143   0.086733   5.271 1.40e-07 ***\n#> as.factor(hospital)43 -1.196426   0.082596 -14.485  < 2e-16 ***\n#> as.factor(hospital)44 -0.389582   0.092446  -4.214 2.54e-05 ***\n#> as.factor(hospital)45 -0.637743   0.077742  -8.203 2.74e-16 ***\n#> as.factor(hospital)46 -0.345502   0.083843  -4.121 3.82e-05 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.7536 on 7316 degrees of freedom\n#> Multiple R-squared:  0.4941,\tAdjusted R-squared:  0.4905 \n#> F-statistic: 140.1 on 51 and 7316 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nThe second regression (using as.factor()) makes more sense as it tests the different hospitals on the different months that's why it is more meaningful. While, the first regression contains all hospitals throughout the whole year which is not useful.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}